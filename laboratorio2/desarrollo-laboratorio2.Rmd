---
title: "Desarrollo Laboratorio 2 - Análisis de Datos"
author: "Profesores: Ramón H. Cornejo-Muñoz y Felipe Rojas</br>Profesor Ayudante de Laboratorio: Mauricio Vargas</br>Ayudantes: Franco Mansilla y Mauricio Díaz"
date: "19 de agosto de 2015"
output: html_document
---

##Pregunta 1
Considere el vector
```{r}
x <- c(0.18, -1.54, 0.42, 0.95)
```
y los ponderadores
```{r}
w <- c(2, 1, 3, 1)
```
Encuentre el valor de $\mu$ que minimiza la ecuación de mínimos cuadrados $\Sigma_{i=1}^n w_i(x_i-\mu)^2$. Hágalo de las siguientes formas:

1. Algebraicamente
2. En Excel (el archivo con los datos es <a href="http://pachamaltese.github.io/analisis-de-datos-unab/laboratorio2-pregunta1.xlsx">laboratorio2-pregunta1.xlsx</a>)
3. En R

###Desarrollo

####Algebraicamente

Sea $S = \displaystyle\Sigma_{i=1}^n w_i(x_i-\mu)^2$

$S = \displaystyle\Sigma_{i=1}^n w_i(x_i^2-2x_i\mu+\mu^2)$

$S = \displaystyle\Sigma_{i=1}^n w_ix_i^2 -2\mu\displaystyle\Sigma_{i=1}^n w_ix_i +\mu^2\displaystyle\Sigma_{i=1}^n w_i$

$\displaystyle \frac{dS}{d\mu} = 0 \Leftrightarrow -2\displaystyle\Sigma_{i=1}^n w_ix_i +2\mu^* \displaystyle\Sigma_{i=1}^n w_i = 0$ 

$\displaystyle \frac{dS}{d\mu} = 0 \Leftrightarrow \mu^* = \frac{\Sigma_{i=1}^n w_ix_i}{\Sigma_{i=1}^n w_i}$

####Excel
Ver archivo <a href="http://pachamaltese.github.io/analisis-de-datos-unab/laboratorio2-desarrollo-pregunta1.xlsx">laboratorio2-desarrollo-pregunta1.xlsx</a>

####R
El promedio ponderado se obtiene con el siguiente comando
```{r}
weighted.mean(x, w) # 0.1471
```

##Pregunta 2
Considere los siguientes vectores de datos
```{r}
x <- c(0.8, 0.47, 0.51, 0.73, 0.36, 0.58, 0.57, 0.85, 0.44, 0.42)
y <- c(1.39, 0.72, 1.55, 0.48, 1.19, -1.59, 1.23, -0.65, 1.49, 0.05)
```
Estime una regresión desde el origen y obtenga la pendiente considerando $y$ como la variable dependiente y $x$ como la variable independiente. ¿Cómo cambia su resultado si estima un modelo con constante?

###Desarrollo
Regresión tal que $\beta_0$ pasa por el origen
```{r}
fit.sc <- lm(y ~ x - 1) #modelo sin constante
summary(fit.sc) # 0.8263

fit.c <- lm(y ~ x) #modelo con constante
summary(fit.c) #-1.713
```

##Pregunta 3
Usando la base de datos mtcars estime un modelo que considere mpg como variable dependiente y la weight como variable independiente. Almacene la pendiente del modelo en memoria con el nombre "beta.1".

###Desarrollo
```{r}
data(mtcars) #para cargar la librería en memoria
fit <- lm(mpg ~ wt, mtcars)
summary(fit) # -5.3445
beta.1 <- c(fit$coefficients[1],fit$coefficients[2])
```

##Pregunta 4
A partir del archivo Excel utilizado en el Laboratorio 1 (<a href="http://pachamaltese.github.io/analisis-de-datos-unab/laboratorio1/laboratorio1.xlsx">laboratorio1.xlsx</a>) obtenga las mismas regresiones (con y sin constante) utilizando R. Para esto siga los siguientes pasos:

1. Definir variables en memoria y cargar librerías
  + Definir el directorio de trabajo.
  + Instalar una librería que permita leer archivos XLSX. Usaremos XLConnect cuya documentación se puede ver en <a href="https://cran.r-project.org/web/packages/XLConnect/XLConnect.pdf">https://cran.r-project.org/web/packages/XLConnect/XLConnect.pdf</a>.
  + Cargar la librería XLConnect.
  + Leer el archivo del Laboratorio 1.
  + Asignar nombres <b>simples</b> a las columnas ($y$, $x_1$, $x_2$).
2. Haga un gráfico de cada variable explicativa sobre la explicada ¿Hay correlación entre ellas?
  + Instalar y cargar en memoria ggplot (librería para graficar)
  + Graficar $y$ versus $x_1$ e $y$ versus $x_2$.
  + Ver la correlación entre las variables.
3. Calcule el estimador de los parámetros.
  + Hacer una correlación sin constante.
  + Hacer una correlación con constante

###Desarrollo

```{r}
#1. Definir variables en memoria y cargar librerías
    #Definir el directorio de trabajo
    dir <- "/Users/pacha/Documents/ayudantias/UNAB/econometria/laboratorio1/"
    
    #Instalar una librería que permita leer archivos XLSX
    #install.packages("XLConnect")
    
    #Cargar la librería XLConnect
    library(XLConnect)
    
    #Leer el archivo del Laboratorio 1
    file <- paste0(dir,"/laboratorio1.xlsx")
    data <- readWorksheetFromFile(file, sheet = "Hoja1", region = "A2:C20", header = FALSE)
    data
    
    #Asignar nombres simples a las columnas
    colnames(data) <- c("y", "x1", "x2")
    data
    
#2. Haga un gráfico de cada variable explicativa sobre la explicada ¿Hay correlación entre ellas?
    
    #Instalar y cargar en memoria ggplot (librería para graficar)
    #install.packages("ggplot2")
    library(ggplot2)
    
    #Graficar y versus x1 e y versus x2
    qplot(x1, y, data=data)
    qplot(x2, y, data=data)
    
    #Ver la correlación entre las variables
    cor(data)
    
#Calcule el estimador de los parámetros
    
    #Hacer una correlación sin constante
    regression_nocons <- lm(y ~ x1 + x2 -1, data=data)
    summary(regression_nocons) 
    
    #Hacer una regresión con constante
    regression_cons <- lm(y ~ x1 + x2, data=data)
    summary(regression_cons)
```

